{"version":3,"file":"draw-and-modify-geodesic.js","mappings":"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","sources":["webpack:///./draw-and-modify-geodesic.js"],"sourcesContent":["import Map from '../src/ol/Map.js';\nimport View from '../src/ol/View.js';\nimport {Circle as CircleStyle, Fill, Stroke, Style} from '../src/ol/style.js';\nimport {Draw, Modify, Snap} from '../src/ol/interaction.js';\nimport {GeometryCollection, Point, Polygon} from '../src/ol/geom.js';\nimport {OSM, Vector as VectorSource} from '../src/ol/source.js';\nimport {Tile as TileLayer, Vector as VectorLayer} from '../src/ol/layer.js';\nimport {circular} from '../src/ol/geom/Polygon.js';\nimport {getDistance} from '../src/ol/sphere.js';\nimport {transform} from '../src/ol/proj.js';\n\nconst raster = new TileLayer({\n  source: new OSM(),\n});\n\nconst source = new VectorSource();\n\nconst style = new Style({\n  fill: new Fill({\n    color: 'rgba(255, 255, 255, 0.2)',\n  }),\n  stroke: new Stroke({\n    color: '#33cc33',\n    width: 2,\n  }),\n  image: new CircleStyle({\n    radius: 7,\n    fill: new Fill({\n      color: '#ffcc33',\n    }),\n  }),\n});\n\nconst geodesicStyle = new Style({\n  geometry: function (feature) {\n    return feature.get('modifyGeometry') || feature.getGeometry();\n  },\n  fill: new Fill({\n    color: 'rgba(255, 255, 255, 0.2)',\n  }),\n  stroke: new Stroke({\n    color: '#ff3333',\n    width: 2,\n  }),\n  image: new CircleStyle({\n    radius: 7,\n    fill: new Fill({\n      color: 'rgba(0, 0, 0, 0)',\n    }),\n  }),\n});\n\nconst vector = new VectorLayer({\n  source: source,\n  style: function (feature) {\n    const geometry = feature.getGeometry();\n    return geometry.getType() === 'GeometryCollection' ? geodesicStyle : style;\n  },\n});\n\nconst map = new Map({\n  layers: [raster, vector],\n  target: 'map',\n  view: new View({\n    center: [-11000000, 6600000],\n    zoom: 3,\n  }),\n});\n\nconst defaultStyle = new Modify({source: source})\n  .getOverlay()\n  .getStyleFunction();\n\nconst modify = new Modify({\n  source: source,\n  style: function (feature) {\n    feature.get('features').forEach(function (modifyFeature) {\n      const modifyGeometry = modifyFeature.get('modifyGeometry');\n      if (modifyGeometry) {\n        const modifyPoint = feature.getGeometry().getCoordinates();\n        const geometries = modifyFeature.getGeometry().getGeometries();\n        const polygon = geometries[0].getCoordinates()[0];\n        const center = geometries[1].getCoordinates();\n        const projection = map.getView().getProjection();\n        let first, last, radius;\n        if (modifyPoint[0] === center[0] && modifyPoint[1] === center[1]) {\n          // center is being modified\n          // get unchanged radius from diameter between polygon vertices\n          first = transform(polygon[0], projection, 'EPSG:4326');\n          last = transform(\n            polygon[(polygon.length - 1) / 2],\n            projection,\n            'EPSG:4326'\n          );\n          radius = getDistance(first, last) / 2;\n        } else {\n          // radius is being modified\n          first = transform(center, projection, 'EPSG:4326');\n          last = transform(modifyPoint, projection, 'EPSG:4326');\n          radius = getDistance(first, last);\n        }\n        // update the polygon using new center or radius\n        const circle = circular(\n          transform(center, projection, 'EPSG:4326'),\n          radius,\n          128\n        );\n        circle.transform('EPSG:4326', projection);\n        geometries[0].setCoordinates(circle.getCoordinates());\n        // save changes to be applied at the end of the interaction\n        modifyGeometry.setGeometries(geometries);\n      }\n    });\n    return defaultStyle(feature);\n  },\n});\n\nmodify.on('modifystart', function (event) {\n  event.features.forEach(function (feature) {\n    const geometry = feature.getGeometry();\n    if (geometry.getType() === 'GeometryCollection') {\n      feature.set('modifyGeometry', geometry.clone(), true);\n    }\n  });\n});\n\nmodify.on('modifyend', function (event) {\n  event.features.forEach(function (feature) {\n    const modifyGeometry = feature.get('modifyGeometry');\n    if (modifyGeometry) {\n      feature.setGeometry(modifyGeometry);\n      feature.unset('modifyGeometry', true);\n    }\n  });\n});\n\nmap.addInteraction(modify);\n\nlet draw, snap; // global so we can remove them later\nconst typeSelect = document.getElementById('type');\n\nfunction addInteractions() {\n  let value = typeSelect.value;\n  let geometryFunction;\n  if (value === 'Geodesic') {\n    value = 'Circle';\n    geometryFunction = function (coordinates, geometry, projection) {\n      if (!geometry) {\n        geometry = new GeometryCollection([\n          new Polygon([]),\n          new Point(coordinates[0]),\n        ]);\n      }\n      const geometries = geometry.getGeometries();\n      const center = transform(coordinates[0], projection, 'EPSG:4326');\n      const last = transform(coordinates[1], projection, 'EPSG:4326');\n      const radius = getDistance(center, last);\n      const circle = circular(center, radius, 128);\n      circle.transform('EPSG:4326', projection);\n      geometries[0].setCoordinates(circle.getCoordinates());\n      geometry.setGeometries(geometries);\n      return geometry;\n    };\n  }\n  draw = new Draw({\n    source: source,\n    type: value,\n    geometryFunction: geometryFunction,\n  });\n  map.addInteraction(draw);\n  snap = new Snap({source: source});\n  map.addInteraction(snap);\n}\n\n/**\n * Handle change event.\n */\ntypeSelect.onchange = function () {\n  map.removeInteraction(draw);\n  map.removeInteraction(snap);\n  addInteractions();\n};\n\naddInteractions();\n"],"names":["raster","TileLayer","source","OSM","VectorSource","style","Style","fill","Fill","color","stroke","Stroke","width","image","CircleStyle","radius","geodesicStyle","geometry","feature","get","getGeometry","vector","VectorLayer","getType","map","Map","layers","target","view","View","center","zoom","defaultStyle","Modify","getOverlay","getStyleFunction","modify","forEach","modifyFeature","modifyGeometry","modifyPoint","getCoordinates","geometries","getGeometries","polygon","projection","getView","getProjection","first","last","transform","length","getDistance","circle","circular","setCoordinates","setGeometries","draw","snap","on","event","features","set","clone","setGeometry","unset","addInteraction","typeSelect","document","getElementById","addInteractions","geometryFunction","value","coordinates","GeometryCollection","Polygon","Point","Draw","type","Snap","onchange","removeInteraction"],"sourceRoot":""}