"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8487],{5336:function(e,i,t){var o=t(5492),n=t(2954),r=t(310),s=t(5284),a=t(776),l=t(7985);const f="version1",u="version2",g="version3",m={};m[f]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}},m[u]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}},m[g]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}},m.none={none:{supports:[],formats:[],qualities:[]}};const p=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,c=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,h=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;const d={};d[f]=function(e){let i=e.getComplianceLevelSupportedFeatures();return void 0===i&&(i=m[f].level0),{url:void 0===e.imageInfo["@id"]?void 0:e.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:i.supports,formats:[...i.formats,void 0===e.imageInfo.formats?[]:e.imageInfo.formats],qualities:[...i.qualities,void 0===e.imageInfo.qualities?[]:e.imageInfo.qualities],resolutions:e.imageInfo.scale_factors,tileSize:void 0!==e.imageInfo.tile_width?void 0!==e.imageInfo.tile_height?[e.imageInfo.tile_width,e.imageInfo.tile_height]:[e.imageInfo.tile_width,e.imageInfo.tile_width]:null!=e.imageInfo.tile_height?[e.imageInfo.tile_height,e.imageInfo.tile_height]:void 0}},d[u]=function(e){const i=e.getComplianceLevelSupportedFeatures(),t=Array.isArray(e.imageInfo.profile)&&e.imageInfo.profile.length>1,o=t&&e.imageInfo.profile[1].supports?e.imageInfo.profile[1].supports:[],n=t&&e.imageInfo.profile[1].formats?e.imageInfo.profile[1].formats:[],r=t&&e.imageInfo.profile[1].qualities?e.imageInfo.profile[1].qualities:[];return{url:e.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:void 0===e.imageInfo.sizes?void 0:e.imageInfo.sizes.map((function(e){return[e.width,e.height]})),tileSize:void 0===e.imageInfo.tiles?void 0:[e.imageInfo.tiles.map((function(e){return e.width}))[0],e.imageInfo.tiles.map((function(e){return void 0===e.height?e.width:e.height}))[0]],resolutions:void 0===e.imageInfo.tiles?void 0:e.imageInfo.tiles.map((function(e){return e.scaleFactors}))[0],supports:[...i.supports,...o],formats:[...i.formats,...n],qualities:[...i.qualities,...r]}},d[g]=function(e){const i=e.getComplianceLevelSupportedFeatures(),t=void 0===e.imageInfo.extraFormats?i.formats:[...i.formats,...e.imageInfo.extraFormats],o=void 0!==e.imageInfo.preferredFormats&&Array.isArray(e.imageInfo.preferredFormats)&&e.imageInfo.preferredFormats.length>0?e.imageInfo.preferredFormats.filter((function(e){return(0,l.q9)(["jpg","png","gif"],e)})).reduce((function(e,i){return void 0===e&&(0,l.q9)(t,i)?i:e}),void 0):void 0;return{url:e.imageInfo.id,sizes:void 0===e.imageInfo.sizes?void 0:e.imageInfo.sizes.map((function(e){return[e.width,e.height]})),tileSize:void 0===e.imageInfo.tiles?void 0:[e.imageInfo.tiles.map((function(e){return e.width}))[0],e.imageInfo.tiles.map((function(e){return e.height}))[0]],resolutions:void 0===e.imageInfo.tiles?void 0:e.imageInfo.tiles.map((function(e){return e.scaleFactors}))[0],supports:void 0===e.imageInfo.extraFeatures?i.supports:[...i.supports,...e.imageInfo.extraFeatures],formats:t,qualities:void 0===e.imageInfo.extraQualities?i.qualities:[...i.qualities,...e.imageInfo.extraQualities],preferredFormat:o}};var v=class{constructor(e){this.setImageInfo(e)}setImageInfo(e){this.imageInfo="string"==typeof e?JSON.parse(e):e}getImageApiVersion(){if(void 0===this.imageInfo)return;let e=this.imageInfo["@context"]||"ol-no-context";"string"==typeof e&&(e=[e]);for(let i=0;i<e.length;i++)switch(e[i]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return f;case"http://iiif.io/api/image/2/context.json":return u;case"http://iiif.io/api/image/3/context.json":return g;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(f)&&this.imageInfo.identifier)return f}(0,a.h)(!1,61)}getComplianceLevelEntryFromProfile(e){if(void 0!==this.imageInfo&&void 0!==this.imageInfo.profile)switch(void 0===e&&(e=this.getImageApiVersion()),e){case f:if(p.test(this.imageInfo.profile))return this.imageInfo.profile;break;case g:if(h.test(this.imageInfo.profile))return this.imageInfo.profile;break;case u:if("string"==typeof this.imageInfo.profile&&c.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&"string"==typeof this.imageInfo.profile[0]&&c.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0]}}getComplianceLevelFromProfile(e){const i=this.getComplianceLevelEntryFromProfile(e);if(void 0===i)return;const t=i.match(/level[0-2](?:\.json)?$/g);return Array.isArray(t)?t[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(void 0===this.imageInfo)return;const e=this.getImageApiVersion(),i=this.getComplianceLevelFromProfile(e);return void 0===i?m.none.none:m[e][i]}getTileSourceOptions(e){const i=e||{},t=this.getImageApiVersion();if(void 0===t)return;const o=void 0===t?void 0:d[t](this);return void 0!==o?{url:o.url,version:t,size:[this.imageInfo.width,this.imageInfo.height],sizes:o.sizes,format:void 0!==i.format&&(0,l.q9)(o.formats,i.format)?i.format:void 0!==o.preferredFormat?o.preferredFormat:"jpg",supports:o.supports,quality:i.quality&&(0,l.q9)(o.qualities,i.quality)?i.quality:(0,l.q9)(o.qualities,"native")?"native":"default",resolutions:Array.isArray(o.resolutions)?o.resolutions.sort((function(e,i){return i-e})):void 0,tileSize:o.tileSize}:void 0}},I=t(6923),y=t(7877);function z(e){return e.toLocaleString("en",{maximumFractionDigits:10})}class B extends n.Z{constructor(e){const i=e||{};let t=void 0===i.imageSmoothing||i.imageSmoothing;void 0!==i.interpolate&&(t=i.interpolate);let n=i.url||"";n+=n.lastIndexOf("/")===n.length-1||""===n?"":"/";const m=i.version||u,p=i.sizes||[],c=i.size;(0,a.h)(null!=c&&Array.isArray(c)&&2==c.length&&!isNaN(c[0])&&c[0]>0&&!isNaN(c[1])&&c[1]>0,60);const h=c[0],d=c[1],v=i.tileSize,B=i.tilePixelRatio||1,q=i.format||"jpg",x=i.quality||(i.version==f?"native":"default");let P=i.resolutions||[];const j=i.supports||[],F=i.extent||[0,-d,h,0],b=null!=p&&Array.isArray(p)&&p.length>0,A=void 0!==v&&("number"==typeof v&&Number.isInteger(v)&&v>0||Array.isArray(v)&&v.length>0),C=null!=j&&Array.isArray(j)&&((0,l.q9)(j,"regionByPx")||(0,l.q9)(j,"regionByPct"))&&((0,l.q9)(j,"sizeByWh")||(0,l.q9)(j,"sizeByH")||(0,l.q9)(j,"sizeByW")||(0,l.q9)(j,"sizeByPct"));let S,w,W;if(P.sort((function(e,i){return i-e})),A||C)if(null!=v&&("number"==typeof v&&Number.isInteger(v)&&v>0?(S=v,w=v):Array.isArray(v)&&v.length>0&&((1==v.length||null==v[1]&&Number.isInteger(v[0]))&&(S=v[0],w=v[0]),2==v.length&&(Number.isInteger(v[0])&&Number.isInteger(v[1])?(S=v[0],w=v[1]):null==v[0]&&Number.isInteger(v[1])&&(S=v[1],w=v[1])))),void 0!==S&&void 0!==w||(S=s.S,w=s.S),0==P.length){W=Math.max(Math.ceil(Math.log(h/S)/Math.LN2),Math.ceil(Math.log(d/w)/Math.LN2));for(let e=W;e>=0;e--)P.push(Math.pow(2,e))}else{const e=Math.max(...P);W=Math.round(Math.log(e)/Math.LN2)}else if(S=h,w=d,P=[],b){p.sort((function(e,i){return e[0]-i[0]})),W=-1;const e=[];for(let i=0;i<p.length;i++){const t=h/p[i][0];P.length>0&&P[P.length-1]==t?e.push(i):(P.push(t),W++)}if(e.length>0)for(let i=0;i<e.length;i++)p.splice(e[i]-i,1)}else P.push(1),p.push([h,d]),W=0;const L=new o.Z({tileSize:[S,w],extent:F,origin:(0,I.rL)(F),resolutions:P}),M=r.z.bind(null,(0,y.Pq)(v||256).map((function(e){return e*B})));super({attributions:i.attributions,attributionsCollapsible:i.attributionsCollapsible,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,interpolate:t,projection:i.projection,reprojectionErrorThreshold:i.reprojectionErrorThreshold,state:i.state,tileClass:M,tileGrid:L,tilePixelRatio:i.tilePixelRatio,tileUrlFunction:function(e,i,t){let o,r;const s=e[0];if(s>W)return;const a=e[1],f=e[2],u=P[s];if(!(void 0===a||void 0===f||void 0===u||a<0||Math.ceil(h/u/S)<=a||f<0||Math.ceil(d/u/w)<=f)){if(C||A){const e=a*S*u,i=f*w*u;let t=S*u,n=w*u,s=S,p=w;if(e+t>h&&(t=h-e),i+n>d&&(n=d-i),e+S*u>h&&(s=Math.floor((h-e+u-1)/u)),i+w*u>d&&(p=Math.floor((d-i+u-1)/u)),0==e&&t==h&&0==i&&n==d)o="full";else if(!C||(0,l.q9)(j,"regionByPx"))o=e+","+i+","+t+","+n;else if((0,l.q9)(j,"regionByPct")){o="pct:"+z(e/h*100)+","+z(i/d*100)+","+z(t/h*100)+","+z(n/d*100)}m!=g||C&&!(0,l.q9)(j,"sizeByWh")?!C||(0,l.q9)(j,"sizeByW")?r=s+",":(0,l.q9)(j,"sizeByH")?r=","+p:(0,l.q9)(j,"sizeByWh")?r=s+","+p:(0,l.q9)(j,"sizeByPct")&&(r="pct:"+z(100/u)):r=s+","+p}else if(o="full",b){const e=p[s][0],i=p[s][1];r=m==g?e==h&&i==d?"max":e+","+i:e==h?"full":e+","}else r=m==g?"max":"full";return n+o+"/"+r+"/0/"+x+"."+q}},transition:i.transition}),this.zDirection=i.zDirection}}var q=B,x=t(1376),P=t(2010),j=t(4354);const F=new P.Z,b=new x.Z({layers:[F],target:"map"}),A=document.getElementById("iiif-notification"),C=document.getElementById("imageInfoUrl");function S(e){fetch(e).then((function(e){e.json().then((function(e){const i=new v(e).getTileSourceOptions();if(void 0===i||void 0===i.version)return void(A.textContent="Data seems to be no valid IIIF image information.");i.zDirection=-1;const t=new q(i);F.setSource(t),b.setView(new j.ZP({resolutions:t.getTileGrid().getResolutions(),extent:t.getTileGrid().getExtent(),constrainOnlyCenter:!0})),b.getView().fit(t.getTileGrid().getExtent()),A.textContent=""})).catch((function(e){A.textContent="Could not read image info json. "+e}))})).catch((function(){A.textContent="Could not read data from URL."}))}document.getElementById("display").addEventListener("click",(function(){S(C.value)})),S(C.value)}},function(e){var i=function(i){return e(e.s=i)};i(9877),i(5336)}]);
//# sourceMappingURL=iiif.js.map